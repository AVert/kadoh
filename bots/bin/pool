#!/usr/bin/env node

//
// Pool CLI
//

var Pool = require(__dirname + '/../pool.js');

var argv = require('optimist')
          .usage('Usage: $0 -s [num] -j foo@bar -p azerty')
          .alias('s', 'size')
          .alias('j', 'jid')
          .alias('p', 'password')
          .alias('b', 'bootstraps')
          .argv;
var protocol   = argv.udp ? 'jsonrpc2' : 'node_xmlrpc',
    type       = argv.udp ? 'UDP'      : 'NodeXMPP',
    size       = parseInt(argv.size, 10) || 10,
    bootstraps = argv.bootstraps.split(',');
    transport  = {
      jid      : argv.jid,
      password : argv.password,
      port     : parseInt(argv.port, 10) || 8000
    };

var config = {
  reactor : {
    protocol  : protocol,
    type      : type,
    transport : transport
  }
};

var pool = new Pool(size, bootstraps, config);
pool.start();
