(function(a){var b=a;b.core={},b.core.Class=function(){function f(a){return j.call(g(a)?a:function(){},a,1)}function g(a){return typeof a===c}function h(a,b,c){return function(){var d=this.supr;this.supr=c[e][a];var f=b.apply(this,arguments);return this.supr=d,f}}function i(a,b,c){for(var f in b)b.hasOwnProperty(f)&&(a[f]=g(b[f])&&g(c[e][f])&&d.test(b[f])?h(f,b[f],c):b[f])}function j(a,b){function c(){}function l(){this.initialize?this.initialize.apply(this,arguments):(b||h&&d.apply(this,arguments),j.apply(this,arguments))}c[e]=this[e];var d=this,f=new c,h=g(a),j=h?a:this,k=h?{}:a;return l.methods=function(a){return i(f,a,d),l[e]=f,this},l.methods.call(l,k).prototype.constructor=l,l.extend=arguments.callee,l[e].implement=l.statics=function(a,b){return a=typeof a=="string"?function(){var c={};return c[a]=b,c}():a,i(this,a,d),this},l}var a=this,b=a.klass,c="function",d=/xyz/.test(function(){xyz})?/\bsupr\b/:/.*/,e="prototype";return f.noConflict=function(){return a.klass=b,this},a.klass=f,f}()})("object"==typeof module?module.exports:this.KadOH=this.KadOH||{})
(function(a){var b=a,c=b.core.Class;b.util={};var d=b.util.Crypto={};d.util=c().statics({rotl:function(a,b){return a<<b|a>>>32-b},rotr:function(a,b){return a<<32-b|a>>>b},endian:function(a){if(a.constructor==Number)return d.util.rotl(a,8)&16711935|d.util.rotl(a,24)&4278255360;for(var b=0;b<a.length;b++)a[b]=d.util.endian(a[b]);return a},randomBytes:function(a){for(var b=[];a>0;a--)b.push(Math.floor(Math.random()*256));return b},bytesToWords:function(a){for(var b=[],c=0,d=0;c<a.length;c++,d+=8)b[d>>>5]|=a[c]<<24-d%32;return b},wordsToBytes:function(a){for(var b=[],c=0;c<a.length*32;c+=8)b.push(a[c>>>5]>>>24-c%32&255);return b},bytesToHex:function(a){for(var b=[],c=0;c<a.length;c++)b.push((a[c]>>>4).toString(16)),b.push((a[c]&15).toString(16));return b.join("")},hexToBytes:function(a){for(var b=[],c=0;c<a.length;c+=2)b.push(parseInt(a.substr(c,2),16));return b},XOR:function(a,b){if(a.length!=b.length)return;"string"==typeof a&&(a=d.util.hexToBytes(a)),"string"==typeof b&&(b=d.util.hexToBytes(b));var c=[];for(var e=0;e<a.length;e++)c.push(a[e]^b[e]);return c},distance:function(a,b){if(a===b)return 0;"string"==typeof a&&(a=d.util.hexToBytes(a)),"string"==typeof b&&(b=d.util.hexToBytes(b));var c=a.length;if(c!=b.length)return-1;var e=8*c;for(i=0;i<c;i++){var f=a[i]^b[i];if(f){for(var g=0;g<7;g++)if(f>>>7-g)break;return e-8*i-g}}return 0}}),d.charenc={},d.charenc.Binary=c().statics({stringToBytes:function(a){for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c)&255);return b},bytesToString:function(a){for(var b=[],c=0;c<a.length;c++)b.push(String.fromCharCode(a[c]));return b.join("")}}),d.charenc.UTF8=c().statics({stringToBytes:function(a){return d.charenc.Binary.stringToBytes(unescape(encodeURIComponent(a)))},bytesToString:function(a){return decodeURIComponent(escape(d.charenc.Binary.bytesToString(a)))}}),d.digest=c().statics({SHA1:function(a,b){var c=d.util.wordsToBytes(d.digest._sha1(a));return b&&b.asBytes?c:b&&b.asString?d.charenc.Binary.bytesToString(c):d.util.bytesToHex(c)},_sha1:function(a){a.constructor==String&&(a=d.charenc.UTF8.stringToBytes(a));var b=d.util.bytesToWords(a),c=a.length*8,e=[],f=1732584193,g=-271733879,h=-1732584194,i=271733878,j=-1009589776;b[c>>5]|=128<<24-c%32,b[(c+64>>>9<<4)+15]=c;for(var k=0;k<b.length;k+=16){var l=f,m=g,n=h,o=i,p=j;for(var q=0;q<80;q++){if(q<16)e[q]=b[k+q];else{var r=e[q-3]^e[q-8]^e[q-14]^e[q-16];e[q]=r<<1|r>>>31}var s=(f<<5|f>>>27)+j+(e[q]>>>0)+(q<20?(g&h|~g&i)+1518500249:q<40?(g^h^i)+1859775393:q<60?(g&h|g&i|h&i)-1894007588:(g^h^i)-899497514);j=i,i=h,h=g<<30|g>>>2,g=f,f=s}f+=l,g+=m,h+=n,i+=o,j+=p}return[f,g,h,i,j]},_blocksize:16,_digestsize:20})})("object"==typeof module?module.exports:this.KadOH=this.KadOH||{})
(function(a){var b=a;b.globals={},b.globals._k=6,b.globals._alpha=3,b.globals._B=160,b.globals._digest=b.util.Crypto.digest.SHA1})("object"==typeof module?module.exports:this.KadOH=this.KadOH||{})
(function(a){var b=a,c=b.core.Class;b.Node=c({initialize:function(a,b,c){typeof c=="undefined"?this.id=this._generateId():this.id=c,this._routing_table=new RoutingTable(this.id)},addPeer:function(a){this._routing_table.addPeer(a)},removePeer:function(a){this._routing_table.removePeer(a)},ping:function(){},findNode:function(){},_generateId:function(){return b.globals._digest(this.ip+":"+this.port)}})})("object"==typeof module?module.exports:this.KadOH=this.KadOH||{})
(function(a){var b=a,c=b.core.Class;b.RoutingTable=c({initialize:function(a){this._parent_id=a,this._kbuckets=[new b.KBucket(0,b.globals._B,a)]},distance:function(a){return b.util.Crypto.util.distance(this._parent_id,a)},addPeer:function(a){if(a.getId()==this._parent_id)return;var b=this._kbucketIndexFor(a.getId()),c=this._kbuckets[b];try{c.addPeer(a)}catch(d){if(c.isSplittable(this.distance(a.getId()))){var e=c.split();this._kbuckets.splice(b+1,0,e),this.addPeer(a)}}},getPeer:function(a){var b=this._kbucketFor(a).getPeer(a);return b?b:!1},removePeer:function(a){return typeof a=="object"&&(a=a.getId()),this._kbucketFor(a).removePeer(a)},getKBuckets:function(){return this._kbuckets},howManyKBuckets:function(){return this._kbuckets.length},getParentId:function(){return this._parent_id},_kbucketIndexFor:function(a){dist=this.distance(a);for(var b=0;b<this._kbuckets.length;b++)if(this._kbuckets[b].distanceInRange(dist))return b;return-1},_kbucketFor:function(a){var b=this._kbucketIndexFor(a);return b!=-1?this._kbuckets[b]:!1}})})("object"==typeof module?module.exports:this.KadOH=this.KadOH||{})
(function(a){var b=a,c=b.core.Class,d=b.util.Crypto;b.KBucket=c({initialize:function(a,c,d){this._min=typeof a=="undefined"?0:a,this._max=typeof c=="undefined"?b.globals._B:c,this._parent_id=d,this._size=0,this._distances=[],this._peers_ids=[],this._peers={}},addPeer:function(a){var b=this._peerExists(a);if(b!=0)this._updatePeer(b);else if(!this.isFull())this._appendPeer(a);else throw console.error("The kbucket "+this.toString()+"is full"),new Error("FULL");return this},getPeer:function(a){var b=this._peerExists(a);return b===!1?!1:this._peers[b.id]},getOldestPeer:function(){return this._peers[this._peers_ids[this._peers_ids.length-1]]},getPeers:function(a){var b=[];a=Math.max(0,Math.min(a,this._size));for(var c=0;c<this._size;c++)b.push(this._peers[this._peers_ids[c]]);return b},removePeer:function(a){var b=this._peerExists(a);if(b===!1)throw new Error(a+" does not exists");return this._deletePeer(b),this},idInRange:function(a,b){return this.distanceInRange(d.util.distance(a,b))},distanceInRange:function(a){return this._min<a&&a<=this._max},getSize:function(){return this._size},getRange:function(){return{min:this._min,max:this._max}},setRange:function(a){return this._min=a.min,this._max=a.max,this},setRangeMin:function(a){return this._min=a,this},setRangeMax:function(a){return this._max=a,this},split:function(){var a=(this._min+this._max)/2,c=new b.KBucket(this._min,a-1,this._parent_id);this.setRangeMin(a);var d,e=[];for(d=0;d<this._size;d++){var f=this._peers_ids[d],g=this._peers[f],h=this._distances[f];c.distanceInRange(h)&&(c.addPeer(g),e.push(f))}for(d=0;d<e.length;d++)this.removePeer(e[d]);return c},isSplittable:function(){return this._min===0},isFull:function(){return this._size==b.globals._k},toString:function(){return"<"+this._min+":"+this._max+"><#"+this._peers_ids.length+">"},_updatePeer:function(a){delete this._peers_ids[a.index],this._peers_ids.unshift(a.id)},_deletePeer:function(a){delete this._peers_ids[a.index],delete this._peers[a.id],delete this._distances[a.index],this._size--},_appendPeer:function(a){var b=a.getId();this._peers[b]=a,this._peers_ids.unshift(b),this._distances[b]=d.util.distance(b,this._parent_id),this._size++},_peerExists:function(a){var b,c;return typeof a=="object"?(b=a.getId(),c=this._peers_ids.indexOf(b)):(b=a,c=this._peers_ids.indexOf(a)),c===-1?!1:{index:c,id:b}}})})("object"==typeof module?module.exports:this.KadOH=this.KadOH||{})
(function(a){var b=a,c=b.core.Class;b.Peer=c({initialize:function(a,b,c){this._ip=a,this._port=b,this._socket=a+":"+b,typeof c=="undefined"?this._id=this._generateId():this._id=c},getID:function(){return this.getId()},getId:function(){return this._id},getSocket:function(){return this._socket},toString:function(){return"<"+this._id+"; "+this._socket+">"},_generateId:function(){return b.globals._digest(this._socket)}})})("object"==typeof module?module.exports:this.KadOH=this.KadOH||{})